{% load static django_htmx %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}RAID Elite{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% django_htmx_script %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    
    <!-- Animate.css -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    
    <!-- AOS (Animate On Scroll) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    
    <!-- Custom RAID Stylesheet -->
    <link rel="stylesheet" href="{% static 'styles/theme.css' %}">
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Cyber Sidebar -->
    <nav class="cyber-sidebar" id="cyberSidebar">
        <div class="cyber-brand animate__animated animate__fadeInDown">
            <i class="fas fa-shield-alt"></i>
            RAID
        </div>
        
        <ul class="nav flex-column sidebar-nav">
            <!-- Dashboard -->
            <li class="nav-item mb-2">
                <a class="nav-link d-flex align-items-center" href="{% url 'core:dashboard' %}">
                    <i class="fa fa-tachometer-alt me-2"></i>
                    <span>Dashboard</span>
                </a>
            </li>

            <!-- Incident Management Group -->
            <h5 class="text-uppercase text-info">Incident Response</h5>
            <hr>
            <li class="nav-item mb-2">
                
                    <li><a class="nav-link" href="{% url 'core:incident_list' %}">
                        <i class="fa fa-list me-2"></i>View All Incidents
                    </a></li>
                    <li><a class="nav-link" href="{% url 'core:incident_create' %}">
                        <i class="fa fa-plus me-2"></i>Create New Incident
                    </a></li>
            </li>

            <h5 class="text-uppercase text-info">Artefacts</h5>
            <hr>
            <li class="nav-item mb-2">
                <li><a class="nav-link" href="{% url 'core:artefact_list' %}">
                    <i class="fa fa-archive me-2"></i>All Artefacts
                </a></li>
                <li><a class="nav-link" href="{% url 'core:artefact_create' %}">
                    <i class="fa fa-upload me-2"></i>Upload Artefact
                </a></li>
            </li>

            <h5 class="text-uppercase text-info">Analysis</h5>
            <hr>
                <li><a class="nav-link" href="{% url 'analysis:dashboard' %}">
                    <i class="fa fa-chart-line me-2"></i>Analysis Dashboard
                </a></li>
                <li><a class="nav-link" href="{% url 'analysis:start' %}">
                    <i class="fa fa-play me-2"></i>Start Analysis
                </a></li>
                <li><a class="nav-link" href="{% url 'analysis:results_by_incident' %}">
                    <i class="fa fa-file-alt me-2"></i>Results by Incident
                </a></li>

            <h5 class="text-uppercase text-info">Client Management</h5>
            <hr>
                    <li><a class="nav-link" href="{% url 'core:client_list' %}">
                        <i class="fa fa-list me-2"></i>View Clients
                    </a></li>
                    <li><a class="nav-link" href="{% url 'core:client_create' %}">
                        <i class="fa fa-plus me-2"></i>Add New Client
                    </a></li>

        
        </ul>

        <!-- System Status -->
        <div class="cyber-panel mt-4" data-aos="fade-up" data-aos-delay="900">
            <h6 class="cyber-text text-neon-blue">System Status</h6>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small">Security Level</span>
                <span class="badge bg-success status-online">DEFCON 2</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small">Threat Level</span>
                <span class="badge bg-warning status-warning">ELEVATED</span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <span class="small">Network</span>
                <span class="badge bg-primary status-online">SECURE</span>
            </div>
        </div>

        <div class="sidebar-footer mt-auto">
            <a href="{% url 'logout' %}" class=" mt-3 btn btn-danger w-100 animate__animated animate__fadeInUp" data-aos="fade-up" data-aos-delay="800">
                <i class="fas fa-power-off"></i>
                <span>Logout</span>
            </a>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <!-- Cyber Header -->
        <header class="cyber-header animate__animated animate__fadeInDown">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="cyber-font text-neon-blue mb-2" data-text="Dashboard">
                            Dashboard
                        </h1>
                        <p class="lead text-secondary mb-0">
                            Advanced Threat Detection & Response Platform
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="d-flex justify-content-end align-items-center gap-3">
                            <!-- Sidebar Toggle -->
                            <button class="btn btn-outline-primary" id="sidebarToggle" data-aos="zoom-in">
                                <i class="fas fa-bars"></i>
                            </button>
                            
                            <!-- Notifications -->
                            <div class="dropdown" data-aos="zoom-in" data-aos-delay="100">
                                <button class="btn btn-outline-warning position-relative" data-bs-toggle="dropdown">
                                    <i class="fas fa-bell"></i>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        7
                                    </span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><h6 class="dropdown-header">Active Alerts</h6></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-exclamation-triangle text-warning me-2"></i>Suspicious Activity Detected</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-shield-alt text-danger me-2"></i>Firewall Breach Attempt</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-bug text-info me-2"></i>Malware Signature Updated</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-center" href="#">View All Alerts</a></li>
                                </ul>
                            </div>
                            
                            <!-- User Profile -->
                            {% if user.is_authenticated %}
                            <div class="dropdown" data-aos="zoom-in" data-aos-delay="200">
                                <button class="btn btn-outline-primary" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-shield"></i>
                                    <span class="ms-2">{{ user.username|default:"Operator" }}</span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="profile"><i class="fas fa-user me-2"></i>Profile</a></li>
                                    <li><a class="dropdown-item" href="settings"><i class="fas fa-cog me-2"></i>Settings</a></li>
                                    <li><a class="dropdown-item" href="security"><i class="fas fa-key me-2"></i>Security</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="logout"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                                </ul>
                            </div>
                            {% else %}
                            <a href="login" class="btn btn-primary" data-aos="zoom-in" data-aos-delay="200">
                                <i class="fas fa-sign-in-alt me-2"></i>Login
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Real-time Stats Bar -->
                <div class="row mt-4">
                    <div class="col-md-3" data-aos="fade-up" data-aos-delay="300">
                        <div class="cyber-panel text-center">
                            <i class="fas fa-shield-alt text-neon-green fs-2 mb-2"></i>
                            <h4 class="text-neon-green mb-1">99.7%</h4>
                            <small class="text-secondary">System Uptime</small>
                        </div>
                    </div>
                    <div class="col-md-3" data-aos="fade-up" data-aos-delay="400">
                        <div class="cyber-panel text-center">
                            <i class="fas fa-bug text-danger fs-2 mb-2"></i>
                            <h4 class="text-danger mb-1">247</h4>
                            <small class="text-secondary">Threats Blocked</small>
                        </div>
                    </div>
                    <div class="col-md-3" data-aos="fade-up" data-aos-delay="500">
                        <div class="cyber-panel text-center">
                            <i class="fas fa-eye text-neon-blue fs-2 mb-2"></i>
                            <h4 class="text-neon-blue mb-1">1.2M</h4>
                            <small class="text-secondary">Events Monitored</small>
                        </div>
                    </div>
                    <div class="col-md-3" data-aos="fade-up" data-aos-delay="600">
                        <div class="cyber-panel text-center">
                            <i class="fas fa-clock text-neon-orange fs-2 mb-2"></i>
                            <h4 class="text-neon-orange mb-1">2.3s</h4>
                            <small class="text-secondary">Avg Response Time</small>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Django Messages -->
        {% if messages %}
            <div class="container-fluid mt-4">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} animate__animated animate__fadeInRight" data-aos="fade-left">
                        <i class="fas fa-info-circle me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Main Content Block -->
        <div class="container-fluid mt-4">
            {% block content %}
            <!-- Default Dashboard Content -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card" data-aos="fade-up">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-area me-2"></i>
                                Threat Landscape Overview
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-neon-blue">Active Monitoring</h6>
                                    <div class="progress mb-3">
                                        <div class="progress-bar" style="width: 85%">85%</div>
                                    </div>
                                    
                                    <h6 class="text-neon-green">System Health</h6>
                                    <div class="progress mb-3">
                                        <div class="progress-bar bg-success" style="width: 92%">92%</div>
                                    </div>
                                    
                                    <h6 class="text-neon-orange">Threat Detection</h6>
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" style="width: 67%">67%</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-secondary mb-3">Recent Activities</h6>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="small">Port Scan Detected</span>
                                        <span class="badge bg-warning">2 min ago</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="small">Firewall Rule Updated</span>
                                        <span class="badge bg-success">5 min ago</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="small">Malware Blocked</span>
                                        <span class="badge bg-danger">8 min ago</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="small">System Backup Complete</span>
                                        <span class="badge bg-info">12 min ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="card" data-aos="fade-up" data-aos-delay="100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Active Threats
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item bg-transparent border-0 px-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1 text-danger">Critical</h6>
                                            <small class="text-muted">SQL Injection Attempt</small>
                                        </div>
                                        <span class="badge bg-danger">HIGH</span>
                                    </div>
                                </div>
                                <div class="list-group-item bg-transparent border-0 px-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1 text-warning">Medium</h6>
                                            <small class="text-muted">Brute Force Login</small>
                                        </div>
                                        <span class="badge bg-warning">MED</span>
                                    </div>
                                </div>
                                <div class="list-group-item bg-transparent border-0 px-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1 text-info">Low</h6>
                                            <small class="text-muted">Suspicious File Access</small>
                                        </div>
                                        <span class="badge bg-info">LOW</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="card mt-4" data-aos="fade-up" data-aos-delay="200">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-bolt me-2"></i>
                                Quick Actions
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary">
                                    <i class="fas fa-shield-alt me-2"></i>
                                    Emergency Lockdown
                                </button>
                                <button class="btn btn-warning">
                                    <i class="fas fa-scan me-2"></i>
                                    Full System Scan
                                </button>
                                <button class="btn btn-info">
                                    <i class="fas fa-download me-2"></i>
                                    Export Logs
                                </button>
                                <button class="btn btn-success">
                                    <i class="fas fa-sync me-2"></i>
                                    Update Signatures
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endblock content %}
        </div>
    </div>

    <!-- Cyber Footer -->
    <footer class="cyber-footer">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">
                        &copy; {% now "Y" %} RAID Elite. Built for elite cyber response teams.
                    </p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="d-flex justify-content-end gap-3">
                        <span class="small">
                            <i class="fas fa-server me-1"></i>
                            Server: <span class="text-neon-green">ONLINE</span>
                        </span>
                        <span class="small">
                            <i class="fas fa-clock me-1"></i>
                            Last Update: <span id="lastUpdate">{% now "H:i:s" %}</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AOS (Animate On Scroll) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    
    <!-- Custom RAID JavaScript -->
    <script>
        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true,
            offset: 100
        });

        // Sidebar Toggle
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('cyberSidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });

        // Real-time clock update
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const lastUpdateElement = document.getElementById('lastUpdate');
            if (lastUpdateElement) {
                lastUpdateElement.textContent = timeString;
            }
        }

        // Update clock every second
        setInterval(updateClock, 1000);

        // Auto-dismiss alerts after 5 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);

        // Add active class to current nav item
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.sidebar-nav a');
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
        });

        // Add loading spinner for forms
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function() {
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
                    submitBtn.disabled = true;
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + D = Dashboard
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyD') {
                window.location.href = "dashboard";
            }
            // Ctrl + Shift + I = Incidents
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyI') {
                window.location.href = "incidents:list";
            }
            // Ctrl + Shift + L = Logout
            if (e.ctrlKey && e.shiftKey && e.code === 'KeyL') {
                window.location.href = "logout";
            }
        });

        // Dropdown toggle functionality
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const parent = dropdown.previousElementSibling;
            const arrow = parent.querySelector('.dropdown-arrow');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                parent.classList.remove('expanded');
            } else {
                // Close other dropdowns first
                document.querySelectorAll('.nav-submenu.show').forEach(menu => {
                    menu.classList.remove('show');
                    const parentLink = menu.previousElementSibling;
                    parentLink.classList.remove('expanded');
                });
                
                // Open current dropdown
                dropdown.classList.add('show');
                parent.classList.add('expanded');
            }
        }

        // Add active states based on current URL
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.sidebar-nav a');
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                    
                    // If it's in a submenu, open the parent dropdown
                    const submenu = link.closest('.nav-submenu');
                    if (submenu) {
                        submenu.classList.add('show');
                        submenu.previousElementSibling.classList.add('expanded');
                    }
                }
            });
        });
    </script>
    
    {% block extra_scripts %}{% endblock extra_scripts %}
</body>
</html>